---
title: vue2-虚拟列表、虚拟树
date: 2023-03-17 19:45:06
permalink: /pages/2bd6ce/
categories:
  - 技术
  - 问题解决方案
tags:
  - 
---

# vue2-虚拟列表、虚拟树

项目内，下拉选择是最为平常使用的空间。

如果提供了良好的操作（键盘选择、模糊搜索），可较大提升用户的使用体验。

因此，一个良好的select框应该支持以下功能：

1. 模糊搜索
2. 键盘交互
3. 回显简单

但数据一旦过大，则需要通过考虑使用懒加载解决dom加载卡顿的问题。
懒加载对于数据的回显则是灾难性的，层级过深，则会调用多次接口。

为了解决这一个问题，提出了一个新的解决方案。虚拟滚动渲染。

<!-- more -->

## vue-virtual-scroll

vue-virtual-scroll提供了一个较为完美的解决方案。

**通过只渲染视口内的元素，从而避免全部直接渲染造成的卡顿**

1. wrapper为视口区域，需要设置高度（默认为100%），元素在内部渲染
2. 根据wrapper高度和item数量，计算出滚动区域的高度。再根据设定的item-size和视口高度计算视口能最多显示的item个数。
3. 在滚动区域内渲染item并为每个item计算偏移量（滚动时，能够定位到真是元素）
4. 进行滚动时，超出视口区域的移出缓存池，进入视口区域的进入缓存池。页面绑定缓存池实时进行刷新

如此，一次virtual-scroll便完成了，其中还需要关注的就是数据内容变更的问题。virtual-scroll给的解决方案是IState。

对于搜索元素，由于每个item的元素在一开始就通过计算得到且固定了，因此实时更新item的位置，就会造成中间可能出现空白的情况。
通过更新整个items可以防止空白问题，但需要整个渲染控件了——这是必须承担的成本。但好在vue做了diff，主要的性能开销在js，那也不足为惧了。

## 虚拟列表

知道virtual-scroll的原理，那再来看el-select的改造。

对于el-select而言，数据量在很大的情况下，用户也不会通过不断下拉进行选择，而是通过搜索结果从而选择。

因此能否快速搜索结果并显示，或在搜索过程中提供较好的交互则变得很重要。

但好在10万多数据，并没有造成过多的负担，流畅运行。

对于el-select-tree而言，展开和收缩都会导致item的变化，变化就会重新计算。

因此是否采用该技术需要权衡考虑。

--- 

select-tree已经集成在elementUi了，基本可满足开发需求。

## 虚拟树

受限于vue-virtual-scroll的实现方案，tree在展开和收缩时，需要对数据进行平铺操作以此告知scroll重新计算所有高度。

因此性能上本就存在一个不足，但仍在可控之内，用户不会过多的体验到。如果你真的需要一个虚拟树形选择，可以考虑该方案。

## 在vue2中的使用

由于已经集成在ElementUi内部，因此需要整体替换ElementUi包。