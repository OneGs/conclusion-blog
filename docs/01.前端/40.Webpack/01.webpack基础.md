---
title: webpack基础
date: 2022-04-19 12:10:12
permalink: /pages/d31461/
categories:
  - 前端
  - Webpack
tags:
  - 
---

# webpack基础

## entry

整个项目的入口，且必须为js文件。

可写形式：

* `string`：当单文件入口
* `Array<string>`：多文件入口
* `{ [key: string]: string | { dependOn: string; filename: string; library: string; import: string; runtime: string; publicPath: string; } }`：既可以单入口，也可以多入口

对象形式关键字解释：

* `dependOn`：多入口共享依赖
* `filename`：文件通用名称，支持文件名称解析规则，如果不存在，则利用对象key和output中的filename生成名称
* `library: string | { name: string; type: umd | module | commonjs ... }`：打包成哪种类型，默认是支持link类型
* `import`：同直接写string，表示需要导入文件的路径
* `runtime`：运行时 chunk 的名字，等同`optimization.runtimeChunk = 'single'`
* `publicPath`：指定入口文件被访问是的公共路径，一般用于多级域名访问。如未执行，则采用`output.publichPath`

<!-- more -->

## output

项目的出口。负责如何输出，输出在哪等问题。其配置较多，列出常用配置：

写法形式：

* `output`: `{ [key: string]: any  }` 

对象形式关键字解释：

* `assetModuleFilename: string`：支持文件名称解析规则，不同于`output.filename`，其是对资源文件的命名
* `chunkFilename: string`：非初始(no-initial)chunk文件名称——import()等，支持文件名称解析规则
* `clean: boolean | { dry: booean; keep: string; }`：清除`output.path`之前的内容
* `filename: string`：后备文件输出名称——当其它情况没有设置名称时，作为后备选项
* `path: string`：文件输出的目录地址
* `library: string | <string>[] | { name: string; type: string; umdNamedDefine: boolean }`：后备内容，指定输出lib的名称和类型等
  * `name: string | <string>[]`：输出的名称，即全局变量名称`var myName`
  * `type: string`：可以打包的类型，'this'、'window'、'self'、'global'、'commonjs'、'commonjs2'...
  * `umdNamedDefine: booealn`：当使用 output.library.type: "umd" 时，将 output.library.umdNamedDefine 设置为 true 将会把 AMD 模块命名为 UMD 构建。否则使用匿名 define

:::tip
output中的配置大多是后备内容。
:::

## devTool

此选项控制是否生成，以及如何生成 source map。

打包程度分类：

1. 打包后的代码：代码经过压缩，代码不在的是独立的module
2. 生成后的代码：代码经过编译，但仍是独立的module，但已经不再是原始的形式
3. 转化过的代码：webpack转化前，loader转化后的代码，代码虽然有改动但接近原始格式
4. 原始源代码：转化前的代码
5. 无源代码：source map 中不包含源代码内容，浏览器通常会尝试从 web 服务器或文件系统加载源代码
6. 仅限行：被简化为每行一个映射

开发环境推荐：

* `eval`：速度快，无法显示行数
* `eval-source-map`：初始较慢，更新快，开发环境的最佳品质

生成环境推荐：

* `none`：不生成sourceMap
* `source-map`：速度快，生产环境的最佳品质
* `hidden-source-map`：没有bundle注释，只有堆栈信息跟踪

## devServe

`webpack-dev-server`配置， 可用于快速开发应用程序。

对象形式关键字解释：

* `allowedHosts: auto | all | <string>[]`：允许将允许访问开发服务器的服务列入白名单
* `headers: { array: <{ key: string; value: string }>[] | () => object | { key: string } }`：为所有响应添加 headers
* `host: string`：指定要使用的 host。如果你想让你的服务器可以被外部访问，像这样指定：`0.0.0.0`
* `hot: boolean`：是否开启热模块替换
* `open: boolean`：告诉 dev-server 在服务器已经启动后打开浏览器
* `port; string`：指定监听请求的端口号
* `proxy: { [key: string]: string }`：将api代理到设置的接口
* `static: string | boolean | <string>[]`：该配置项允许配置从目录提供静态文件的选项（默认是 'public' 文件夹）
* `publicPath: string`：告诉服务器在哪个 URL 上提供 `static.directory` 的内容，[更多细节](https://webpack.docschina.org/configuration/dev-server/#publicpath)

## loader

loader用于将非js资源转化成js，以能够集成到项目。

每个规则可以分为三部分 - 条件(condition)，结果(result)和嵌套规则(nested rule)。[more](https://webpack.docschina.org/configuration/module/#modulerules)

1. Rule 条件：在规则中，属性 test, include, exclude 和 resource 对 资源(resource) 进行匹配，并且属性 issuer 对 issuer 匹配。当使用多个条件时，所有条件都匹配
2. Rule 结果：规则结果只在规则条件匹配时使用。应用在 resource 上的 loader 数组。这些属性会影响 `loader：loader, options, use`
3. 嵌套的 Rule：可以使用属性 rules 和 oneOf 指定嵌套规则。这些规则用于在规则条件(rule condition)匹配时进行取值。每个嵌套规则包含它自己的条件

对象形式关键字解释：

* `exclude: string`：排除所有符合条件的模块
* `include: string`：引入符合以下任何条件的模块
* `loader`：`Rule.use: [ { loader } ]` 的简写
* `oneOf: <{ resourceQuery: string; use: string }>[]`：规则数组，当规则匹配时，只使用第一个匹配规则
* `test: string`：引入所有通过断言测试的模块，你提供了一个 `Rule.test` 选项，就不能再提供 `Rule.resource`
* `type: string`：你提供了一个 Rule.test 选项，就不能再提供 Rule.resource，可设置值: `'javascript/auto' | 'javascript/dynamic' | 'javascript/esm' | 'json' | 'webassembly/sync' | 'webassembly/async' | 'asset' | 'asset/source' | 'asset/resource' | 'asset/inline'`
* `use: UseEntry`：Loaders 可以通过传入多个 loaders 以达到链式调用的效果，它们会从右到左被应用
  * `loader: string`：指定加载的模块
  * `options：{ [key: string]: any }`：加载模块的可选项配置
  * `resolve: any`：模块解析可以在模块层被配置，优先级高于root的resolve

常见配置：

1. css
```javascript
module: {
    rules: [
        {
            test: /\.css$/i, // 检查匹配
            use: ['style-loader', 'css-loader'], // 执行顺序从右往左
            include: _.resole(__dirname, 'src') // 限定css查找范围，可以编译速度
        },
        {
            test: /\.scss$/i,
            use: ['style-loader', 'css-loader', 'scss-loader'],
            include: _.resole(__dirname, 'src')
        }
    ]
}
```

2. images
```javascript
module: {
    rules: [
        {
            test: /\.(png|svg|jpg|jpeg|gif)$/i,
            type: 'asset/resource',
            include: _.resole(__dirname, 'assets/images')
        }
    ]
}
```

3. fonts
```javascript
module: {
    rules: [
        {
            test: /\.(woff|woff2|eot|ttf|otf)$/i,
            type: 'asset/resource',
            include: _.resole(__dirname, 'assets/fonts')
        }
    ]
}
```

## plugins

## cached

## optimization && code splitting

## tree shaking

## source map
